version: '3'

networks:
  main:
    driver: bridge

volumes:
  disk:
    driver: local

services:

### App service
  app:
    build:
      context: ./docker/php/
      args:
        - SOURCE_ROOT_PATH=${SOURCE_ROOT_PATH}
        - PUID=${PUID}
        - PGID=${PGID}
    ports:
      - 9000:9000
    volumes:
      - disk:/app
      - ${SOURCE_ROOT_PATH}theme:/app/themes/${THEME_AUTHOR}:cached
      - ${SOURCE_ROOT_PATH}plugins:/app/plugins/${PLUGINS_AUTHOR}:cached
    networks:
      - main

### Apache service
  apache:
    image: docker.io/bitnami/apache:2.4-debian-10
    ports:
      - ${WEB_HTTP_PORT}:8080
      - ${WEB_HTTPS_PORT}:8443
    volumes:
      - ./docker/apache/httpd.conf:/opt/bitnami/apache/conf/httpd.conf:ro
      - ./docker/apache/vhost.conf:/vhosts/custom-vhost.conf:ro
      - disk:/app
      - ${SOURCE_ROOT_PATH}theme:/app/themes/${THEME_AUTHOR}:cached
      - ${SOURCE_ROOT_PATH}plugins:/app/plugins/${PLUGINS_AUTHOR}:cached
    depends_on:
      - app
    networks:
      - main

### Maildev service
  maildev:
    image: djfarrelly/maildev
    ports:
      - ${MAILDEV_HTTP_PORT}:80
      - ${MAILDEV_SMTP_PORT}:25
    networks:
      - main
